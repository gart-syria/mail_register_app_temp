[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Mail Register",
  "enabled": 1,
  "modified": "2026-01-18 09:36:01.330620",
  "module": "Mail Register App",
  "name": "Auto Select for Issuing Receiving office if inbox from external entity",
  "script": "frappe.ui.form.on(\"Mail Register\", {\n    from_external_entity(frm) {\n        if (frm.doc.from_external_entity) {\n\n            // Ø¬Ù„Ø¨ Ø§Ù„Ø¯ÙŠÙˆØ§Ù† Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ\n            frappe.db.get_value(\n                \"Diwan\",\n                { \"name1\": \"Ø§Ù„Ø¯ÙŠÙˆØ§Ù† Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ\" },\n                \"name\"\n            ).then(r => {\n                if (r && r.message && r.message.name) {\n                    frm.set_value(\"receiver_office\", r.message.name);\n\n                    // âœ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Received\n                    frm.set_value(\"status\", \"Received\");\n                } else {\n                    frappe.msgprint(\n                        \"âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¯ÙŠÙˆØ§Ù† Ø¨Ø§Ø³Ù… 'Ø§Ù„Ø¯ÙŠÙˆØ§Ù† Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ' ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ name1\"\n                    );\n                }\n            });\n\n            // ØªØ¹Ø¨Ø¦Ø© ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…\n            const today = frappe.datetime.now_date();\n            frm.set_value(\"received_date\", today);\n\n            frappe.show_alert({\n                message: \"ğŸ“© Ø¨Ø±ÙŠØ¯ ÙˆØ§Ø±Ø¯ Ù…Ù† Ø¬Ù‡Ø© Ø®Ø§Ø±Ø¬ÙŠØ© â€” ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ Received\",\n                indicator: \"green\"\n            });\n\n        } else {\n            // ÙÙŠ Ø­Ø§Ù„ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙØ¹ÙŠÙ„\n            frm.set_value(\"receiver_office\", \"\");\n            frm.set_value(\"received_date\", \"\");\n            frm.set_value(\"status\", \"Draft\"); // Ø£Ùˆ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¹Ù†Ø¯Ùƒ\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Mail Register",
  "enabled": 1,
  "modified": "2025-11-03 09:32:07.847882",
  "module": "Mail Register App",
  "name": "Change Mail Status from Draft to Sent v2",
  "script": "frappe.ui.form.on(\"Mail Register\", {\n    refresh(frm) {\n        update_status_based_on_recipients(frm);\n    },\n    recipients_add(frm, cdt, cdn) {\n        update_status_based_on_recipients(frm);\n    },\n    recipients_remove(frm, cdt, cdn) {\n        update_status_based_on_recipients(frm);\n    },\n    external_recipients_add(frm, cdt, cdn) {\n        update_status_based_on_recipients(frm);\n    },\n    external_recipients_remove(frm, cdt, cdn) {\n        update_status_based_on_recipients(frm);\n    }\n});\n\nfunction update_status_based_on_recipients(frm) {\n    // âš ï¸ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³ØªÙ„Ù…Ø§Ù‹ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù„Ø§ Ù†ØºÙŠÙ‘Ø± Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ø·Ù„Ø§Ù‚Ø§Ù‹\n    if (frm.doc.status === \"Received\") {\n        return;\n    }\n\n    const has_internal = (frm.doc.recipients || []).length > 0;\n    const has_external = (frm.doc.external_recipients || []).length > 0;\n\n    if ((has_internal || has_external) && frm.doc.status !== \"Sent\") {\n        frm.set_value(\"status\", \"Sent\");\n        frappe.show_alert({\n            message: \"ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø¥Ù„Ù‰ (Sent) âœ…\",\n            indicator: \"green\"\n        });\n    }\n    else if (!has_internal && !has_external && frm.doc.status !== \"Draft\") {\n        frm.set_value(\"status\", \"Draft\");\n        frappe.show_alert({\n            message: \"ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ (Draft)\",\n            indicator: \"orange\"\n        });\n    }\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Incoming Confirmation Queue",
  "enabled": 1,
  "modified": "2026-01-20 10:55:24.475573",
  "module": "Mail Register App",
  "name": "Updated Auto Compose Inbox When Recieving Mail",
  "script": "frappe.ui.form.on('Incoming Confirmation Queue', {\n    received_confirmed(frm) {\n\n        if (!frm.doc.received_confirmed) {\n            return;\n        }\n\n        frappe.confirm(\n            __('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ£ÙƒÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø¨Ø±ÙŠØ¯ ÙˆØ§Ø±Ø¯ØŸ'),\n            () => {\n                frappe.call({\n                    method: \"mail_register_app.api.confirm_received\",\n                    args: {\n                        queue_name: frm.doc.name\n                    },\n                    callback: function(r) {\n                        if (r.message) {\n                            frappe.show_alert({\n                                message: \"âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„ÙˆØ§Ø±Ø¯\",\n                                indicator: \"green\"\n                            });\n\n                            frm.reload_doc();\n                        }\n                    }\n                });\n            },\n            () => {\n                frm.set_value(\"received_confirmed\", 0);\n            }\n        );\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Mail Register",
  "enabled": 1,
  "modified": "2026-01-12 11:00:07.067365",
  "module": "Mail Register App",
  "name": "Button For Adding Notes To Mail",
  "script": "frappe.ui.form.on(\"Mail Register\", {\n    refresh: function (frm) {\n\n        if (frm.doc.mail_type === \"Incoming\" && frm.doc.__islocal !== 1) {\n\n            frm.add_custom_button(\n                __(\"Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ø´ÙŠØ©\"),\n                function () {\n                    frappe.new_doc(\"Mail Annotation\", {\n                        mail_register: frm.doc.name\n                    });\n                },\n                __(\"Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª\")\n            );\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Mail Register",
  "enabled": 1,
  "modified": "2026-01-20 08:40:14.240218",
  "module": "Mail Register App",
  "name": "Button For Adding Replay To Mail",
  "script": "frappe.ui.form.on(\"Mail Register\", {\n    refresh(frm) {\n\n        if (\n            frm.doc.mail_type === \"Incoming\" &&\n            frm.doc.__islocal !== 1\n        ) {\n            frm.add_custom_button(\n                __(\"Ø§Ù„Ø±Ø¯ Ø¨ÙƒØªØ§Ø¨ ØµØ§Ø¯Ø±\"),\n                function () {\n                    create_reply_outgoing(frm);\n                },\n                __(\"Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª\")\n            );\n        }\n    }\n});\n\nfunction create_reply_outgoing(frm) {\n\n    frappe.confirm(\n        \"Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ø´Ø§Ø¡ ÙƒØªØ§Ø¨ ØµØ§Ø¯Ø± Ø±Ø¯Ù‹Ø§ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ØŸ\",\n        () => {\n            frappe.new_doc(\"Mail Register\", {\n                mail_type: \"Outgoing\",\n                direction: \"Outgoing\",\n                reply_to: frm.doc.name,\n                subject: \"Ø±Ø¯ Ø¹Ù„Ù‰: \" + (frm.doc.subject || \"\"),\n                issuing_office: frm.doc.receiver_office,\n                mail_date: frappe.datetime.now_date()\n            });\n        }\n    );\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Mail Register",
  "enabled": 1,
  "modified": "2026-01-15 10:12:17.167758",
  "module": "Mail Register App",
  "name": "Button To Show Replays",
  "script": "frappe.ui.form.on(\"Mail Register\", {\n    refresh(frm) {\n\n        // Ù„Ø§ Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø²Ø± Ù„Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯\n        if (frm.doc.__islocal === 1) return;\n\n        frm.add_custom_button(\n            __(\"Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø¯ÙˆØ¯\"),\n            function () {\n                show_replies(frm);\n            },\n            __(\"Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª\")\n        );\n    }\n});\n\nfunction show_replies(frm) {\n\n    // ğŸ“¥ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆØ§Ø±Ø¯\n    // Ù†Ø¹Ø±Ø¶ Ø§Ù„ØµØ§Ø¯Ø± Ø§Ù„Ø°ÙŠ ØªÙ… Ø¨Ù‡ Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡\n    if (frm.doc.mail_type === \"Incoming\") {\n\n        frappe.route_options = {\n            reply_to: frm.doc.name\n        };\n\n        frappe.set_route(\"List\", \"Mail Register\");\n        return;\n    }\n\n    // ğŸ“¤ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ ØµØ§Ø¯Ø±\n    // Ù†Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ§Ø±Ø¯Ø§Øª Ø§Ù„ØªÙŠ Ø¬Ø§Ø¡Øª ÙƒØ±Ø¯ Ø¹Ù„ÙŠÙ‡\n    if (frm.doc.mail_type === \"Outgoing\") {\n\n        frappe.route_options = {\n            mail_type: \"Incoming\",\n            root_outgoing_mail: frm.doc.name\n        };\n\n        frappe.set_route(\"List\", \"Mail Register\");\n        return;\n    }\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Mail Register",
  "enabled": 1,
  "modified": "2026-01-18 08:54:53.096707",
  "module": "Mail Register App",
  "name": "Auto Fill Issuing Office",
  "script": "frappe.ui.form.on(\"Mail Register\", {\n    onload(frm) {\n\n        // ØªØ­Ø¯ÙŠØ¯ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…\n        frm.set_query(\"issuing_office\", function () {\n            return {\n                query: \"frappe.db.get_list\",\n                filters: {\n                    doctype: \"User Diwan Mapping\",\n                    user: frappe.session.user\n                }\n            };\n        });\n\n        // ØªØ¹Ø¨Ø¦Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙÙ‚Ø·\n        if (frm.doc.__islocal === 1 && !frm.doc.issuing_office) {\n\n            frappe.call({\n                method: \"frappe.client.get_value\",\n                args: {\n                    doctype: \"User Diwan Mapping\",\n                    filters: {\n                        user: frappe.session.user\n                    },\n                    fieldname: \"diwan\"\n                },\n                callback: function (r) {\n                    if (r.message && r.message.diwan) {\n                        frm.set_value(\"issuing_office\", r.message.diwan);\n                    }\n                }\n            });\n        }\n    },\n\n    refresh(frm) {\n        // Ù…Ù†Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸\n        if (frm.doc.__islocal !== 1) {\n            frm.set_df_property(\"issuing_office\", \"read_only\", 1);\n        }\n    }\n});\n\nfrappe.ui.form.on(\"Mail Register\", {\n    validate(frm) {\n        // Ø¥Ø°Ø§ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ø¨Ø§Ù„Ø®Ø·Ø£\n        if (!frm.doc.issuing_office) {\n            frappe.call({\n                method: \"frappe.client.get_value\",\n                args: {\n                    doctype: \"User Diwan Mapping\",\n                    filters: {\n                        user: frappe.session.user\n                    },\n                    fieldname: \"diwan\"\n                },\n                callback: function (r) {\n                    if (r.message && r.message.diwan) {\n                        frm.set_value(\"issuing_office\", r.message.diwan);\n                    } else {\n                        frappe.throw(__(\"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯ÙŠÙˆØ§Ù† Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…\"));\n                    }\n                }\n            });\n        }\n    }\n});\n",
  "view": "Form"
 }
]